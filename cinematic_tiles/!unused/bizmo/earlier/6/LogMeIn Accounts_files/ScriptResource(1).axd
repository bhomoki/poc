Type.registerNamespace("LMI");Type.registerNamespace("LMI.Connection");LMI.Connection.AjaxRequest=function(){};LMI.Connection.AjaxRequest.genericWSCall=function(n,h,i,b,j,d,k,l){var a=null,g=Sys.Serialization.JavaScriptSerializer,m=g.serialize(n),c=h==a?a:Function.createCallback(h,j),f=i==a?a:Function.createCallback(i,j),e=LMI.Connection.AjaxRequest._showPleaseWait(k,l);jQuery.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:d,data:m,dataType:"json",success:function(f){b!=a&&b();LMI.Connection.AjaxRequest._hidePleaseWait(e);if(c==a)return;var h=LMI.Connection.AjaxRequest._isEmpty(f);if(h)c();else{var g=d.substr(d.lastIndexOf("/")+1)+"Result",i=f[g];c(i)}},error:function(h){b!=a&&b();LMI.Connection.AjaxRequest._hidePleaseWait(e);if(f==a)return;var c=g.deserialize(h.responseText),d=LMI.Connection.AjaxRequest._genericWSErrorCallback(c);if(d)return;f(c)}})};LMI.Connection.AjaxRequest._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return false;return true};LMI.Connection.AjaxRequest._genericWSErrorCallback=function(a){var b=a.StatusCode;if(b==1){window.location=a.Details;return true}return false};LMI.Connection.AjaxRequest._showPleaseWait=function(a,b){if(a<0)return null;if(b)return setTimeout('LMI.Connection.AjaxRequest.pleaseWait(true, "'+b+'")',a);return setTimeout("LMI.Connection.AjaxRequest.pleaseWait(true)",a)};LMI.Connection.AjaxRequest._hidePleaseWait=function(a){if(a==null)return;clearTimeout(a);LMI.Connection.AjaxRequest.pleaseWait(false)};LMI.Connection.AjaxRequest.pleaseWait=function(g,d){var a="UpdateProgress";if(g){if(!$get(a)){var b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href="/css/elements/loading.css";document.getElementsByTagName("head")[0].appendChild(b);var f=d?d:'<div class="LoadingPanel"><div class="PanelTop"><div><div></div></div></div><div class="Middle"><div class="Left"><div class="Right"><div><img src="/img/page/boxes/central/loader_24x26.gif" width="24" height="26" alt="" />&nbsp;&nbsp;</div></div></div></div><div class="PanelBottom"><div><div></div></div></div></div>',c=document.createElement("div");c.id=a;c.innerHTML=f;document.body.appendChild(c)}var e=$get(a);e.style.display="block";LMI.Connection.AjaxRequest._centerProgress(e)}else if($get(a))$get(a).style.display="none"};LMI.Connection.AjaxRequest._centerProgress=function(b){var a=jQuery(b);a.css("position","absolute").css("display","block").css("top",(jQuery(window).height()-a.height())/2+jQuery(window).scrollTop()+"px").css("left",(jQuery(window).width()-a.width())/2+jQuery(window).scrollLeft()+"px")};Type.registerNamespace("LMI");Type.registerNamespace("LMI.Connection");LMI.Connection.HttpRequest=function(){};LMI.Connection.HttpRequest.QueryString=function(){};LMI.Connection.HttpRequest.QueryString.getValue=function(d,c){var b=new RegExp("[\\?&]"+d.toLowerCase()+"=([^&#]*)"),e=c?window.location.href:window.location.href.toLowerCase(),a=b.exec(e);return a==null?null:decodeURIComponent(a[1])};Type.registerNamespace("LMI");LMI.HTMLEncode=function(a){if(typeof a=="number")return a;return a.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\'/mg,"&#39;").replace(/\"/mg,"&quot;")};LMI.HTMLDecode=function(a){if(typeof a=="number")return a;return a.replace(/&quot;/mg,'"').replace(/&#39;/mg,"'").replace(/&gt;/mg,">").replace(/&lt;/mg,"<").replace(/&amp;/mg,"&")};Type.registerNamespace("LMI");LMI.isEmailValid=function(b){var a=/^((?!(.+\.\.+))(?!(.+\.@+))(?!(^\.))([\w-+!#\$\.']+))@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;return a.test(b)};var LMI=LMI||{};LMI.Utils=LMI.Utils||{};LMI.Utils.string=function(){var b=function(){var a={"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"'},c=[],d,b;for(d in a)c.push(d);b=new RegExp("("+c.join("|")+"|&#[0-9]{1,5};)","g");return function(c){return !c?c:String(c).replace(b,function(c,b){if(b in a)return a[b];else return String.fromCharCode(parseInt(b.substr(2),10))})}}(),c=function(){var a={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;"},c=[],d,b;for(d in a)c.push(d);b=new RegExp("("+c.join("|")+")","g");return function(c){return !c?c:String(c).replace(b,function(c,b){return a[b]})}}(),d=function(a){var b=String.prototype.trim;if(b)return LMI.isUndefined(a)?"":b.call(a);return LMI.isUndefined(a)?"":a.toString().replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};function a(a){return /^[\s\xa0]*$/.test(a)}return {encode:c,decode:b,trim:d,isEmpty:a}}();var LMI=LMI||{};LMI.UI=LMI.UI||{};LMI.UI.DomHelpers=function(){var a=" ";function e(c,b){for(var a,d=c.attributes,e=d.length;e--;){a=d[e];if(c.hasAttribute&&a.specified&&LMI.typeOf(b.attributes[a.name])!=="undefined")b[a.name]=a.value;else b[a.name]=a.value}}function h(d,c){var b=a+d.className+a;return b.indexOf(a+c+a)!==-1}function g(e,f){var h=e.className,d=f.split(a),g=d.length,c,b;if(!h&&g===1)e.className=f;else{b=a+h+a;for(c=g;c--;)if(!~b.indexOf(a+d[c]+a))b+=d[c]+a;e.className=LMI.Utils.string.trim(b)}}function f(c,h){var g=c.className,e=h.split(a),f=e.length,d,b;if(!g&&f===1)c.className="";else{b=a+g+a;for(d=f;d--;)b=b.replace(a+e[d]+a,a);c.className=LMI.Utils.string.trim(b)}}function d(a,b){if(a.removeProperty)a.removeProperty(b);else a[b]=""}function m(d,b){var c=b.nextElementSibling||b.nextSibling,a=b.parentNode;if(!a){a=document.createDocumentFragment();a.appendChild(b)}if(c){a.insertBefore(d,c);return a}else{a.appendChild(d);return a}}function j(c,b){var a=b.parentNode;if(!a){a=document.createDocumentFragment();a.appendChild(b)}a.insertBefore(c,b);return a}function c(b){var a;function d(a){try{return a.firstElementChild||a.firstChild}catch(b){return false}}while(a=d(b)){!LMI.isUndefined(a)&&c(a);b.removeChild(a)}}function l(a){c(a);a.parentNode&&a.parentNode.removeChild(a)}function b(b,a){if(b.style[a])return b.style[a];else if(b.currentStyle)return b.currentStyle[a];else if(document.defaultView&&document.defaultView.getComputedStyle){a=a.replace(/([A-Z])/g,"-$1");a=a.toLowerCase();s=document.defaultView.getComputedStyle(b,"");return s&&s.getPropertyValue(a)}else return null}function n(a,d){var c=a.offsetWidth;switch(LMI.typeOf(d)){case "boolean":if(!d)return c;else return c+parseInt(b(a,"marginLeft"),10)+parseInt(b(a,"marginRight"),10);case "number":a.style.width=d+"px";break;default:return c}}function k(a,d){var c=a.offsetHeight;switch(LMI.typeOf(d)){case "boolean":if(!d)return c;else return c+parseInt(b(a,"marginTop"),10)+parseInt(b(a,"marginBottom"),10);case "number":a.style.height=d+"px";break;default:return c}}function i(){var b,a=document.documentElement,c=document.getElementsByTagName("body")[0];if(!LMI.isUndefined(window.innerWidth))b={width:window.innerWidth,height:window.innerHeight};else if(!LMI.isUndefined(a)&&!LMI.isUndefined(a.clientWidth)&&a.clientWidth!=0)b={width:a.clientWidth,height:a.clientHeight};else b={width:c.clientWidth,height:c.clientHeight};return b}return {cloneAttributes:e,hasClass:h,addClass:g,removeClass:f,removeAttributeProperty:d,after:m,before:j,empty:c,remove:l,width:n,height:k,getStyle:b,viewPort:i}}();var LMI=LMI||{};LMI.UI=LMI.UI||{};LMI.UI.Events=function(){var a="on",d="[Event - bind] delegate must be defined.",c="[Event - bind] eventName must be defined.",b="[Event - bind] dom element must be defined.",h,f,t={ALT:18,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,CTRL:17,ENTER:13,END:35,HOME:36,TAB:9,SHIFT:16,PAGE_UP:33,PAGE_DOWN:34,BACKSPACE:8,CAPSLOCK:20,DEL:46,ESC:27,INS:45,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,START:91};function g(f,e,g){if(LMI.isUndefined(f))throw new Error(b);if(LMI.isUndefined(e))throw new Error(c);if(LMI.isUndefined(g))throw new Error(d);if(f.attachEvent){e=/on$/.test(e)?e:a+e;f.attachEvent(e,g)}else{e=/on$/.test(e)?e.replace(a,""):e;f.addEventListener(e,g,false)}}function j(f,e,g){if(LMI.isUndefined(f))throw new Error(b);if(LMI.isUndefined(e))throw new Error(c);if(LMI.isUndefined(g))throw new Error(d);if(f.detachEvent){e=/on$/.test(e)?e:a+e;f.detachEvent(e,g)}else{e=/on$/.test(e)?e.replace(a,""):e;f.removeEventListener(e,g,false)}}function n(b){for(var a,c=b.length;c--;){a=b[c];g(a.element,a.event,a.handler)}}function l(b){for(var a,c=b.length;c--;){a=b[c];j(a.element,a.event,a.handler);a.handler=null}b.length=0}function e(){if(LMI.isUndefined(f))return f=new LMI.Data.HashTable;return f}function p(b,a){e().add(b,a)}function o(a){e().remove(a)}function k(a){var b=a.keys();for(i=b.length;i--;)a.item(b[i])()}function m(){window.clearTimeout(h);h=window.setTimeout(function(){k(e())},50)}g(window,"resize",m);function q(a){if(!a)a=window.event;if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true}function r(a){if(!a)a=window.event;if(a.preventDefault)a.preventDefault();else a.returnValue=false}function s(a){if(!a)a=window.event;return a.target||a.srcElement}return {bind:g,unbind:j,bindEvents:n,unbindEvents:l,addWindowResize:p,removeWindowResize:o,stopPropagation:q,preventDefault:r,eventTarget:s,keys:t}}();LMI=LMI||{};LMI.UI=LMI.UI||{};LMI.UI.Controls=LMI.UI.Controls||{};LMI.UI.Controls.TextBox=function(x,g){var a=new LMI.UI.Controls.Control(x,g),h=LMI.UI.DomHelpers,l=LMI.UI.Events,b=[],c=document.createElement("span"),e,j=0,m=100;function k(a){if(j===0)j=setInterval(f,m);if(!LMI.isUndefined(a)){c.innerHTML=a;return e=a}if(!LMI.isUndefined(e))return e;if(g&&!LMI.isUndefined(g.waterMarkText))return e=g.waterMarkText;else return e=""}function v(){return a.getElement().value}function r(){a.getValue()!==""&&d()}function w(b){a.getElement().value=b;r()}function n(){l.unbindEvents(b)}function t(a){return a.keyCode?a.keyCode:a.which}function u(b){var a=t(b);switch(a){case LMI.UI.Events.keys.CAPSLOCK:case LMI.UI.Events.keys.ALT:case LMI.UI.Events.keys.CTRL:case LMI.UI.Events.keys.ARROW_LEFT:case LMI.UI.Events.keys.ARROW_UP:case LMI.UI.Events.keys.ARROW_RIGHT:case LMI.UI.Events.keys.ARROW_DOWN:case LMI.UI.Events.keys.ENTER:case LMI.UI.Events.keys.HOME:case LMI.UI.Events.keys.END:case LMI.UI.Events.keys.SHIFT:case LMI.UI.Events.keys.PAGE_UP:case LMI.UI.Events.keys.PAGE_DOWN:case LMI.UI.Events.keys.BACKSPACE:case LMI.UI.Events.keys.ESC:case LMI.UI.Events.keys.INS:case LMI.UI.Events.keys.DEL:case LMI.UI.Events.keys.NUMLOCK:case LMI.UI.Events.keys.START:return;default:d()}}function q(){a.getValue().length===0&&i()}function p(){h.addClass(c,"focused");if(a.getValue().length===0)return;d()}function s(){a.getValue().length===0&&i();h.removeClass(c,"focused")}function o(){a.getElement().focus()}function d(){c.style.display="none"}function i(){h.removeAttributeProperty(c.style,"display")}function y(){var e=a.getElement(),g=c.cloneNode(false);a.getContainer(g);g.className="inliner textbox";g.appendChild(c);c.className="watermark";c.innerHTML=k();e.value!==""&&d();h.before(g,e);g.appendChild(e);b[0]={element:e,event:"focus",handler:p};b[1]={element:e,event:"blur",handler:s};b[2]={element:c,event:"click",handler:o};b[3]={element:e,event:"keyup",handler:q};b[4]={element:e,event:"keydown",handler:u};b[5]={element:e,event:"propertychange",handler:f};b[6]={element:e,event:"change",handler:f};b[7]={element:e,event:"input",handler:f};l.bindEvents(b)}function f(){if(a.getValue()!=="")d();else i()}a.redraw=y;a.waterMarkText=k;a.getValue=v;a.setValue=w;a.setDisposeDelegate(n);a.redraw();return a};Type.registerNamespace("LMI.Login");Type.registerNamespace("LMI.Login.ClientService");LMI.Login.ClientService.CheckEmail=function(i,b,d,h,a,c,e,f){var g={email:i,clusterId:b,returnUrl:d,qrCode:h,allowExisting:a},j="ClientService.svc/CheckEmail";LMI.Connection.AjaxRequest.genericWSCall(g,c,e,null,f,j,-1)};LMI.Login.ClientService.CheckQrLogin=function(g,a,c,b,d,e){var f={qrCode:g,verificationCode:a,returnUrl:c},h="ClientService.svc/CheckQrLogin";LMI.Connection.AjaxRequest.genericWSCall(f,b,d,null,e,h,-1)};LMI.Login.ClientService.TrackUser=function(a,c,b,d,e,f){var g={trackingProductType:a,trackingUniqueId:c,trackingActionId:b},h="ClientService.svc/TrackUser";LMI.Connection.AjaxRequest.genericWSCall(g,d,e,null,f,h,-1)};LMI.Login.ClientService.IsCommonPassword=function(c,a,b,d){var e={password:c},f="ClientService.svc/IsCommonPassword";LMI.Connection.AjaxRequest.genericWSCall(e,a,b,null,d,f,-1)};LMI.Login.ClientService.EmailExists=function(d,a,b){var c={email:d},e="ClientService.svc/EmailExists";LMI.Connection.AjaxRequest.genericWSCall(c,a,null,null,b,e,-1)};Type.registerNamespace("LMI");Type.registerNamespace("LMI.Login");LMI.Login.InputChangeType={initialValue:0,keyUp:1,focusLost:2,periodic:3};LMI.Login.InputChangeDetector=function(i,g){var a=$get(i),c=null,e=g;b(LMI.Login.InputChangeType.initialValue);$addHandler(a,"keyup",k);$addHandler(a,"blur",j);d();function k(){b(LMI.Login.InputChangeType.keyUp)}function j(){b(LMI.Login.InputChangeType.focusLost)}function d(){setInterval(h,1e3)}function h(){var b=a.value;setTimeout(function(){f(b)},500)}function f(c){var d=a.value;if(d!=c)return;b(LMI.Login.InputChangeType.periodic)}function b(b){var d=a.value;if(d==c&&b==LMI.Login.InputChangeType.periodic)return;c=d;e(b)}};Type.registerNamespace("LMI");Type.registerNamespace("LMI.Login");LMI.Login.emailState={invalid:0,validNotFederated:1,validFederated:2,validExisting:3};LMI.Login.EmailValidator=function(c,j,i){var e=$get(c),k=new LMI.Login.InputChangeDetector(c,d),h=function(){d(LMI.Login.InputChangeType.focusLost)},b=null;function d(d){var c=jQuery.trim(e.value),h=LMI.isEmailValid(c),k=h?LMI.Login.emailState.validNotFederated:LMI.Login.emailState.invalid,m={state:k,email:c,identityProviderUrl:null,inputChangeType:d};if(b===c&&d!==LMI.Login.InputChangeType.focusLost)return;b=c;a(m);if(!h)return;var l=LoginContext.getClusterId(),n=LoginContext.getReturnUrl(),j=$get("qr"),p=j?j.value:null,o={email:c,inputChangeType:d};LMI.Login.ClientService.CheckEmail(c,l,n,p,i,f,g,o)}function a(a){var b=jQuery.trim(e.value);if(a.email!==b)return;j(a)}function f(b,c){var d={state:b.status,email:c.email,identityProviderUrl:b.identityProviderUrl,inputChangeType:c.inputChangeType};a(d)}function g(a){throw new Error("GetIdentityProviderUrl returned unknown statusCode: "+a.StatusCode);}return {emailChangedCallback:h}};Type.registerNamespace("LMI");Type.registerNamespace("LMI.Login");LMI.Login.LoginValidator=function(){var c="error",b="#email",a="nodisplay",e="email",g=$("#trFederatedMessage"),k=$get("trPassword"),j=$("#trRememberMe"),h=$("#registerLink0"),i=$("#registerLink"),f=$("#forgotPasswordLink"),r=$("#recaptcha_widget"),d=$("#errMessageForEmail"),s=new LMI.Login.EmailValidator(e,q,true);function q(a){p(a);l(a)}function p(e){if(e.inputChangeType!==LMI.Login.InputChangeType.focusLost&&e.state===LMI.Login.emailState.invalid){d.addClass(a);jQuery(b).removeClass(c);return}if(e.email==""){d.addClass(a);jQuery(b).removeClass(c);return}var f=e.inputChangeType==LMI.Login.InputChangeType.initialValue||e.inputChangeType==LMI.Login.InputChangeType.focusLost?0:LMI.Login.LOGINGLOBAL.InvalidMessageDelay;if(e.state===LMI.Login.emailState.invalid)setTimeout(function(){m(e)},f);else if(n(e))setTimeout(function(){o(e)},f);else{d.addClass(a);jQuery(b).removeClass(c)}}function n(a){return LMI.Login.LoginContextConfig.needaccountkeys&&a.state===LMI.Login.emailState.validFederated}function l(a){if(a.state===LMI.Login.emailState.validFederated){g.show();k.style.visibility="hidden";j.hide();h.hide();i.hide();f.hide();r.hide()}else{g.hide();k.style.visibility="";j.show();h.show();i.show();f.show()}}function m(f){var g=jQuery.trim($get(e).value);if(f.email!=g)return;d[0].innerHTML="Invalid email format";d.removeClass(a);jQuery(b).addClass(c)}function o(f){var g=jQuery.trim($get(e).value);if(f.email!=g)return;d[0].innerHTML="Active Directory account cannot be used to log in here";d.removeClass(a);jQuery(b).addClass(c)}};Sys.Application.add_load(loginPageLoad);function loginPageLoad(){var c="trackingUniqueId",a=false,b="trackingProductType",e=new LMI.Login.LoginValidator;initTextboxes();var d=$("#email")[0].value;if(d=="")$("#email").focus();else $("#password").focus();$("#btnSubmit").click(function(){var d=LMI.Connection.HttpRequest.QueryString.getValue(b,a),e=LMI.Connection.HttpRequest.QueryString.getValue(c,a);LMI.Login.ClientService.TrackUser(d,e,57)});$("#registerLink").click(function(){var d=LMI.Connection.HttpRequest.QueryString.getValue(b,a),e=LMI.Connection.HttpRequest.QueryString.getValue(c,a);LMI.Login.ClientService.TrackUser(d,e,58)})}function initTextboxes(){var a="password",c,b;c=LMI.UI.Controls.TextBox(document.getElementById("email")).waterMarkText("email");b=LMI.UI.Controls.TextBox(document.getElementById(a)).waterMarkText(a)}function onForgotPasswordClick(){if(LMI.Login.LoginContextConfig.invite)return;var b=$get("email").value,a=$get("forgotPasswordLink");if(b=="")return;a.href=LMI.Utils.uri.addOrOverrideParameter(a.href,"email",b)}